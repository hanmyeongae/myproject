<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµ ê´€ë¦¬ ì‹œìŠ¤í…œ - School Management System</title>

    <!-- React ë° í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Material-UI -->
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f5f5f5;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(45deg, #1976d2, #42a5f5);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 2rem;
            gap: 2rem;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .content-area {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .login-form {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #1976d2;
        }

        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
            resize: vertical;
            min-height: 100px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #1976d2;
        }

        .btn {
            background: linear-gradient(45deg, #1976d2, #42a5f5);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            background: linear-gradient(45deg, #1565c0, #1976d2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .nav-item:hover {
            background: #f0f7ff;
            color: #1976d2;
        }

        .nav-item.active {
            background: #e3f2fd;
            color: #1976d2;
            font-weight: 500;
        }

        .nav-icon {
            margin-right: 1rem;
            width: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            text-align: center;
            padding: 2rem 1rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1976d2;
        }

        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        .table tbody tr:hover {
            background: #f9f9f9;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-present {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-absent {
            background: #ffebee;
            color: #c62828;
        }

        .status-late {
            background: #fff3e0;
            color: #f57c00;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .role-admin {
            background: #fff3e0;
            color: #f57c00;
        }

        .role-homeroom {
            background: #e3f2fd;
            color: #1976d2;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .success-message {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        /* ì±„íŒ… ìŠ¤íƒ€ì¼ */
        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .chat-header {
            padding: 1rem;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .chat-message.own {
            align-self: flex-end;
            background: #1976d2;
            color: white;
        }

        .chat-message.other {
            align-self: flex-start;
            background: #f0f0f0;
            color: #333;
        }

        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
        }

        .chat-send-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
        }

        .chat-send-btn:hover {
            background: #1565c0;
        }

        /* ì£¼ê°„ê³„íš ìŠ¤íƒ€ì¼ */
        .weekly-plan {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .day-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 1rem;
            min-height: 200px;
        }

        .day-header {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #1976d2;
        }

        .day-content {
            font-size: 0.875rem;
            color: #666;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                padding: 1rem;
            }

            .sidebar {
                width: 100%;
                margin-bottom: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 0.875rem;
            }

            .weekly-plan {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useContext, createContext } = React;

        // ============================================================================
        // íƒ€ì… ë° ìƒìˆ˜ ì •ì˜
        // ============================================================================

        const UserRole = {
            ADMIN: 'admin',
            HOMEROOM_TEACHER: 'homeroom_teacher'
        };

        const Permission = {
            // í•™ìƒ ê´€ë ¨ ê¶Œí•œ
            VIEW_STUDENTS: 'view_students',
            MANAGE_STUDENTS: 'manage_students',
            EDIT_STUDENT_INFO: 'edit_student_info',

            // ì¶œì„ ê´€ë ¨ ê¶Œí•œ
            VIEW_ATTENDANCE: 'view_attendance',
            MANAGE_ATTENDANCE: 'manage_attendance',

            // í•™ë¶€ëª¨ ê´€ë ¨ ê¶Œí•œ
            VIEW_PARENT_INFO: 'view_parent_info',
            CONTACT_PARENTS: 'contact_parents',

            // ë°˜ ê´€ë¦¬ ê¶Œí•œ
            MANAGE_CLASS: 'manage_class',
            VIEW_CLASS_REPORTS: 'view_class_reports',

            // ìƒë‹´ ê¶Œí•œ
            CONDUCT_COUNSELING: 'conduct_counseling',
            VIEW_COUNSELING_RECORDS: 'view_counseling_records',

            // ê´€ë¦¬ì ê¶Œí•œ
            MANAGE_WEEKLY_PLANS: 'manage_weekly_plans',
            VIEW_ALL_REPORTS: 'view_all_reports',
            CHAT_WITH_TEACHERS: 'chat_with_teachers'
        };

        // ============================================================================
        // ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
        // ============================================================================

        class AuthService {
            constructor() {
                this.sampleUsers = [
                    {
                        id: 'admin1',
                        name: 'ê¹€ê´€ë¦¬',
                        email: 'admin@school.edu',
                        role: UserRole.ADMIN,
                        profileImage: 'https://via.placeholder.com/150',
                        createdAt: new Date('2023-01-01'),
                        isActive: true
                    },
                    {
                        id: 'teacher1',
                        name: 'ë°•ë‹´ì„',
                        email: 'homeroom1@school.edu',
                        role: UserRole.HOMEROOM_TEACHER,
                        classId: 'class-3-1',
                        className: '3í•™ë…„ 1ë°˜',
                        profileImage: 'https://via.placeholder.com/150',
                        createdAt: new Date('2023-01-01'),
                        isActive: true
                    },
                    {
                        id: 'teacher2',
                        name: 'ì´ë‹´ì„',
                        email: 'homeroom2@school.edu',
                        role: UserRole.HOMEROOM_TEACHER,
                        classId: 'class-3-2',
                        className: '3í•™ë…„ 2ë°˜',
                        profileImage: 'https://via.placeholder.com/150',
                        createdAt: new Date('2023-01-01'),
                        isActive: true
                    }
                ];
            }

            async login(email, password) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const user = this.sampleUsers.find(u => u.email === email);
                        resolve(user || null);
                    }, 1000);
                });
            }

            async logout() {
                return new Promise((resolve) => {
                    setTimeout(resolve, 500);
                });
            }
        }

        class RBACService {
            constructor() {
                this.rolePermissions = {
                    [UserRole.ADMIN]: [
                        // ê´€ë¦¬ìëŠ” ëª¨ë“  ê¶Œí•œ ë³´ìœ 
                        Permission.VIEW_STUDENTS,
                        Permission.MANAGE_STUDENTS,
                        Permission.EDIT_STUDENT_INFO,
                        Permission.VIEW_ATTENDANCE,
                        Permission.MANAGE_ATTENDANCE,
                        Permission.VIEW_PARENT_INFO,
                        Permission.CONTACT_PARENTS,
                        Permission.MANAGE_CLASS,
                        Permission.VIEW_CLASS_REPORTS,
                        Permission.CONDUCT_COUNSELING,
                        Permission.VIEW_COUNSELING_RECORDS,
                        Permission.MANAGE_WEEKLY_PLANS,
                        Permission.VIEW_ALL_REPORTS,
                        Permission.CHAT_WITH_TEACHERS
                    ],
                    [UserRole.HOMEROOM_TEACHER]: [
                        // ë‹´ì„êµì‚¬ëŠ” ë‹´ì„ ê´€ë ¨ ê¶Œí•œë§Œ
                        Permission.VIEW_STUDENTS,
                        Permission.MANAGE_STUDENTS,
                        Permission.EDIT_STUDENT_INFO,
                        Permission.VIEW_ATTENDANCE,
                        Permission.MANAGE_ATTENDANCE,
                        Permission.VIEW_PARENT_INFO,
                        Permission.CONTACT_PARENTS,
                        Permission.MANAGE_CLASS,
                        Permission.VIEW_CLASS_REPORTS,
                        Permission.CONDUCT_COUNSELING,
                        Permission.VIEW_COUNSELING_RECORDS
                    ]
                };
            }

            checkPermission(user, permission, resource) {
                if (!user || !user.isActive) {
                    return { allowed: false, reason: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.' };
                }

                const rolePermissions = this.rolePermissions[user.role] || [];
                if (!rolePermissions.includes(permission)) {
                    return { allowed: false, reason: 'í•´ë‹¹ ì—­í• ì— ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.' };
                }

                return { allowed: true };
            }

            canAccessScreen(user, screenName) {
                const screenPermissions = {
                    'Students': [Permission.VIEW_STUDENTS],
                    'Attendance': [Permission.VIEW_ATTENDANCE],
                    'Reports': [Permission.VIEW_CLASS_REPORTS],
                    'WeeklyPlans': [Permission.MANAGE_WEEKLY_PLANS],
                    'Chat': [Permission.CHAT_WITH_TEACHERS]
                };

                const requiredPermissions = screenPermissions[screenName];
                if (!requiredPermissions) return true;

                return requiredPermissions.some(permission =>
                    this.checkPermission(user, permission).allowed
                );
            }
        }

        class DataService {
            constructor() {
                this.students = [
                    { id: '1', name: 'í™ê¸¸ë™', classId: 'class-3-1', grade: 3, studentNumber: '20230001', parentContact: '010-1234-5678' },
                    { id: '2', name: 'ê¹€ì˜í¬', classId: 'class-3-1', grade: 3, studentNumber: '20230002', parentContact: '010-2345-6789' },
                    { id: '3', name: 'ë°•ì² ìˆ˜', classId: 'class-3-2', grade: 3, studentNumber: '20230003', parentContact: '010-3456-7890' },
                    { id: '4', name: 'ì´ë¯¼ì •', classId: 'class-3-2', grade: 3, studentNumber: '20230004', parentContact: '010-4567-8901' }
                ];

                this.attendance = [
                    { id: '1', studentId: '1', date: '2024-01-15', status: 'present' },
                    { id: '2', studentId: '2', date: '2024-01-15', status: 'present' },
                    { id: '3', studentId: '3', date: '2024-01-15', status: 'late' },
                    { id: '4', studentId: '4', date: '2024-01-15', status: 'absent' }
                ];

                this.weeklyPlans = {
                    'week-2024-01-15': {
                        monday: 'ì „ì²´ ì¡°íšŒ, 1êµì‹œ ìˆ˜í•™, 2êµì‹œ êµ­ì–´',
                        tuesday: '1êµì‹œ ê³¼í•™, 2êµì‹œ ì˜ì–´, ë°©ê³¼í›„ í™œë™',
                        wednesday: 'ì²´ìœ¡ëŒ€íšŒ ì¤€ë¹„, 3êµì‹œ ìŒì•…',
                        thursday: '1êµì‹œ ë¯¸ìˆ , 2êµì‹œ ë„ë•, í•™ê¸‰íšŒì˜',
                        friday: 'ì£¼ê°„ í‰ê°€, ì²­ì†Œì‹œê°„, ì¢…ë¡€',
                        saturday: '',
                        sunday: ''
                    }
                };

                this.chatMessages = [
                    { id: '1', from: 'admin1', to: 'teacher1', message: 'ì•ˆë…•í•˜ì„¸ìš”! ì´ë²ˆ ì£¼ ê³„íšì€ ì–´ë–»ê²Œ ì§„í–‰ë˜ê³  ìˆë‚˜ìš”?', timestamp: new Date('2024-01-15 09:00'), sender: 'admin' },
                    { id: '2', from: 'teacher1', to: 'admin1', message: 'ë„¤, ìˆœì¡°ë¡­ê²Œ ì§„í–‰ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì²´ìœ¡ëŒ€íšŒ ì¤€ë¹„ê°€ ì¡°ê¸ˆ ë°”ì˜ë„¤ìš”.', timestamp: new Date('2024-01-15 09:05'), sender: 'teacher' },
                    { id: '3', from: 'admin1', to: 'teacher1', message: 'ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. í•„ìš”í•œ ì§€ì›ì´ ìˆìœ¼ë©´ ë§ì”€í•´ ì£¼ì„¸ìš”.', timestamp: new Date('2024-01-15 09:10'), sender: 'admin' }
                ];
            }

            async getStudents(classId) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const students = classId
                            ? this.students.filter(s => s.classId === classId)
                            : this.students;
                        resolve(students);
                    }, 500);
                });
            }

            async getAttendance(classId, date) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        let attendance = this.attendance;
                        if (date) attendance = attendance.filter(a => a.date === date);
                        resolve(attendance);
                    }, 500);
                });
            }

            async getWeeklyPlan(weekId) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve(this.weeklyPlans[weekId] || {
                            monday: '', tuesday: '', wednesday: '', thursday: '',
                            friday: '', saturday: '', sunday: ''
                        });
                    }, 500);
                });
            }

            async saveWeeklyPlan(weekId, plan) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        this.weeklyPlans[weekId] = plan;
                        resolve(true);
                    }, 500);
                });
            }

            async getChatMessages(userId1, userId2) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const messages = this.chatMessages.filter(m =>
                            (m.from === userId1 && m.to === userId2) ||
                            (m.from === userId2 && m.to === userId1)
                        );
                        resolve(messages);
                    }, 500);
                });
            }

            async sendChatMessage(from, to, message) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const newMessage = {
                            id: Date.now().toString(),
                            from,
                            to,
                            message,
                            timestamp: new Date(),
                            sender: from.includes('admin') ? 'admin' : 'teacher'
                        };
                        this.chatMessages.push(newMessage);
                        resolve(newMessage);
                    }, 500);
                });
            }

            async getHomeroomTeachers() {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const teachers = [
                            { id: 'teacher1', name: 'ë°•ë‹´ì„', className: '3í•™ë…„ 1ë°˜' },
                            { id: 'teacher2', name: 'ì´ë‹´ì„', className: '3í•™ë…„ 2ë°˜' }
                        ];
                        resolve(teachers);
                    }, 500);
                });
            }
        }

        // ============================================================================
        // Context
        // ============================================================================

        const AuthContext = createContext();

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(false);

            const authService = new AuthService();
            const rbacService = new RBACService();

            const login = async (email, password) => {
                setIsLoading(true);
                try {
                    const userData = await authService.login(email, password);
                    if (userData) {
                        setUser(userData);
                        localStorage.setItem('user', JSON.stringify(userData));
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    return false;
                } finally {
                    setIsLoading(false);
                }
            };

            const logout = async () => {
                setUser(null);
                localStorage.removeItem('user');
                await authService.logout();
            };

            const checkPermission = (permission, resource) => {
                return rbacService.checkPermission(user, permission, resource);
            };

            const canAccessScreen = (screenName) => {
                return rbacService.canAccessScreen(user, screenName);
            };

            useEffect(() => {
                const storedUser = localStorage.getItem('user');
                if (storedUser) {
                    setUser(JSON.parse(storedUser));
                }
            }, []);

            return (
                <AuthContext.Provider value={{
                    user,
                    isLoading,
                    login,
                    logout,
                    checkPermission,
                    canAccessScreen,
                    isAuthenticated: !!user
                }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        const useAuth = () => {
            const context = useContext(AuthContext);
            if (!context) {
                throw new Error('useAuth must be used within AuthProvider');
            }
            return context;
        };

        // ============================================================================
        // ì»´í¬ë„ŒíŠ¸ë“¤
        // ============================================================================

        // ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
        const LoginScreen = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const { login, isLoading } = useAuth();

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');

                if (!email || !password) {
                    setError('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const success = await login(email, password);
                if (!success) {
                    setError('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            };

            return (
                <div className="login-container">
                    <form className="login-form" onSubmit={handleSubmit}>
                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                            <h1 style={{ color: '#1976d2', marginBottom: '0.5rem' }}>í•™êµ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                            <p style={{ color: '#666' }}>ë¡œê·¸ì¸í•˜ì—¬ ì‹œìŠ¤í…œì„ ì´ìš©í•´ì£¼ì„¸ìš”</p>
                        </div>

                        {error && (
                            <div className="error-message">
                                {error}
                            </div>
                        )}

                        <div className="form-group">
                            <label htmlFor="email" style={{ display: 'block', marginBottom: '0.5rem', color: '#333' }}>
                                ì´ë©”ì¼
                            </label>
                            <input
                                id="email"
                                type="email"
                                className="form-input"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                                disabled={isLoading}
                            />
                        </div>

                        <div className="form-group">
                            <label htmlFor="password" style={{ display: 'block', marginBottom: '0.5rem', color: '#333' }}>
                                ë¹„ë°€ë²ˆí˜¸
                            </label>
                            <input
                                id="password"
                                type="password"
                                className="form-input"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                disabled={isLoading}
                            />
                        </div>

                        <button
                            type="submit"
                            className="btn"
                            disabled={isLoading}
                        >
                            {isLoading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
                        </button>

                        <div style={{ marginTop: '2rem', padding: '1rem', background: '#f5f5f5', borderRadius: '4px' }}>
                            <p style={{ margin: 0, fontWeight: '600', marginBottom: '0.5rem' }}>í…ŒìŠ¤íŠ¸ ê³„ì •:</p>
                            <p style={{ margin: 0, fontSize: '0.875rem' }}>ê´€ë¦¬ì: admin@school.edu</p>
                            <p style={{ margin: 0, fontSize: '0.875rem' }}>ë‹´ì„êµì‚¬1: homeroom1@school.edu</p>
                            <p style={{ margin: 0, fontSize: '0.875rem' }}>ë‹´ì„êµì‚¬2: homeroom2@school.edu</p>
                            <p style={{ margin: '0.5rem 0 0 0', fontSize: '0.875rem', color: '#666' }}>ë¹„ë°€ë²ˆí˜¸ëŠ” ì•„ë¬´ê±°ë‚˜ ì…ë ¥í•˜ì„¸ìš”</p>
                        </div>
                    </form>
                </div>
            );
        };

        // í—¤ë” ì»´í¬ë„ŒíŠ¸
        const Header = () => {
            const { user, logout } = useAuth();

            return (
                <div className="header">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div>
                            <h1 style={{ margin: 0, fontSize: '1.5rem' }}>í•™êµ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                            <p style={{ margin: '0.25rem 0 0 0', opacity: 0.9 }}>
                                {user?.name}ë‹˜ ({user?.role === UserRole.ADMIN ? 'ê´€ë¦¬ì' : 'ë‹´ì„êµì‚¬'})
                                {user?.className && ` - ${user.className}`}
                            </p>
                        </div>
                        <button
                            onClick={logout}
                            style={{
                                background: 'rgba(255,255,255,0.2)',
                                color: 'white',
                                border: '1px solid rgba(255,255,255,0.3)',
                                padding: '0.5rem 1rem',
                                borderRadius: '4px',
                                cursor: 'pointer'
                            }}
                        >
                            ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            );
        };

        // ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
        const Sidebar = ({ activeScreen, setActiveScreen }) => {
            const { user, canAccessScreen } = useAuth();

            const menuItems = [
                { id: 'dashboard', name: 'ëŒ€ì‹œë³´ë“œ', icon: 'ğŸ“Š' },
                { id: 'students', name: 'í•™ìƒ ê´€ë¦¬', icon: 'ğŸ‘¥', permission: 'Students' },
                { id: 'attendance', name: 'ì¶œì„ ê´€ë¦¬', icon: 'ğŸ“…', permission: 'Attendance' },
                { id: 'reports', name: 'ë³´ê³ ì„œ', icon: 'ğŸ“‹', permission: 'Reports' },
                { id: 'weekly-plans', name: 'ì£¼ê°„ê³„íš', icon: 'ğŸ“…', permission: 'WeeklyPlans', adminOnly: true },
                { id: 'chat', name: 'ì±„íŒ…', icon: 'ğŸ’¬', permission: 'Chat' }
            ];

            const filteredMenuItems = menuItems.filter(item => {
                if (item.adminOnly && user?.role !== UserRole.ADMIN) return false;
                return !item.permission || canAccessScreen(item.permission);
            });

            return (
                <div className="sidebar">
                    <div style={{ marginBottom: '2rem' }}>
                        <div style={{ display: 'flex', alignItems: 'center', marginBottom: '1rem' }}>
                            <img
                                src={user?.profileImage || 'https://via.placeholder.com/60'}
                                alt="Profile"
                                style={{
                                    width: '60px',
                                    height: '60px',
                                    borderRadius: '50%',
                                    marginRight: '1rem',
                                    objectFit: 'cover'
                                }}
                            />
                            <div>
                                <div style={{ fontWeight: '600', color: '#333' }}>{user?.name}</div>
                                <div style={{ fontSize: '0.875rem', color: '#666' }}>
                                    {user?.role === UserRole.ADMIN ? 'ì‹œìŠ¤í…œ ê´€ë¦¬ì' : user?.className}
                                </div>
                            </div>
                        </div>
                        <div className={`role-badge ${user?.role === UserRole.ADMIN ? 'role-admin' : 'role-homeroom'}`}>
                            {user?.role === UserRole.ADMIN ? 'ê´€ë¦¬ì' : 'ë‹´ì„êµì‚¬'}
                        </div>
                    </div>

                    <nav>
                        {filteredMenuItems.map(item => (
                            <div
                                key={item.id}
                                className={`nav-item ${activeScreen === item.id ? 'active' : ''}`}
                                onClick={() => setActiveScreen(item.id)}
                            >
                                <span className="nav-icon">{item.icon}</span>
                                {item.name}
                            </div>
                        ))}
                    </nav>
                </div>
            );
        };

        // ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
        const Dashboard = () => {
            const { user } = useAuth();
            const [stats, setStats] = useState({
                totalStudents: 0,
                totalClasses: 0,
                presentToday: 0,
                pendingTasks: 0
            });

            useEffect(() => {
                // ì‹¤ì œ ì•±ì—ì„œëŠ” APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
                if (user?.role === UserRole.ADMIN) {
                    setStats({
                        totalStudents: 120,
                        totalClasses: 6,
                        presentToday: 115,
                        pendingTasks: 3
                    });
                } else {
                    setStats({
                        totalStudents: 28,
                        totalClasses: 1,
                        presentToday: 26,
                        pendingTasks: 2
                    });
                }
            }, [user]);

            return (
                <div>
                    <h2 style={{ marginBottom: '2rem', color: '#333' }}>ëŒ€ì‹œë³´ë“œ</h2>

                    <div className="stats-grid">
                        <div className="card stat-card">
                            <div className="stat-number">{stats.totalStudents}</div>
                            <div className="stat-label">ì „ì²´ í•™ìƒ ìˆ˜</div>
                        </div>
                        <div className="card stat-card">
                            <div className="stat-number">{stats.totalClasses}</div>
                            <div className="stat-label">ë‹´ë‹¹ í•™ê¸‰ ìˆ˜</div>
                        </div>
                        <div className="card stat-card">
                            <div className="stat-number">{stats.presentToday}</div>
                            <div className="stat-label">ì˜¤ëŠ˜ ì¶œì„</div>
                        </div>
                        <div className="card stat-card">
                            <div className="stat-number">{stats.pendingTasks}</div>
                            <div className="stat-label">ëŒ€ê¸° ì¤‘ì¸ ì—…ë¬´</div>
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">ìµœê·¼ í™œë™</div>
                        <div>
                            {user?.role === UserRole.ADMIN ? (
                                <div>
                                    <p>â€¢ ì´ë²ˆ ì£¼ ì£¼ê°„ê³„íš ì‘ì„± ì™„ë£Œ</p>
                                    <p>â€¢ ë‹´ì„êµì‚¬ë“¤ê³¼ ì±„íŒ… 3ê±´</p>
                                    <p>â€¢ ì „ì²´ ì¶œì„ë¥  í˜„í™© í™•ì¸</p>
                                    <p>â€¢ ì›”ê°„ ë³´ê³ ì„œ ê²€í† </p>
                                </div>
                            ) : (
                                <div>
                                    <p>â€¢ {user?.className} ì¶œì„ ì²´í¬ ì™„ë£Œ</p>
                                    <p>â€¢ í•™ë¶€ëª¨ ìƒë‹´ ì¼ì • 2ê±´ ì˜ˆì •</p>
                                    <p>â€¢ í•™ê¸‰ ë³´ê³ ì„œ ì‘ì„±</p>
                                    <p>â€¢ ê´€ë¦¬ìì™€ ì±„íŒ… í™•ì¸</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">ê¶Œí•œ ì •ë³´</div>
                        <div>
                            <p><strong>ì—­í• :</strong> {user?.role === UserRole.ADMIN ? 'ì‹œìŠ¤í…œ ê´€ë¦¬ì' : 'ë‹´ì„êµì‚¬'}</p>
                            {user?.role === UserRole.ADMIN ? (
                                <div>
                                    <p><strong>ê´€ë¦¬ ë²”ìœ„:</strong> ì „ì²´ í•™êµ</p>
                                    <p><strong>ì£¼ìš” ê¶Œí•œ:</strong> ì£¼ê°„ê³„íš ì‘ì„±, ì „ì²´ ë³´ê³ ì„œ ì¡°íšŒ, ë‹´ì„êµì‚¬ ì±„íŒ…</p>
                                </div>
                            ) : (
                                <div>
                                    <p><strong>ë‹´ë‹¹ ë°˜:</strong> {user?.className}</p>
                                    <p><strong>ì£¼ìš” ê¶Œí•œ:</strong> í•™ìƒ ê´€ë¦¬, ì¶œì„ ê´€ë¦¬, í•™ë¶€ëª¨ ì—°ë½, ë³´ê³ ì„œ ì¡°íšŒ</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // í•™ìƒ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸
        const Students = () => {
            const { user, checkPermission } = useAuth();
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(true);

            const dataService = new DataService();

            useEffect(() => {
                loadStudents();
            }, []);

            const loadStudents = async () => {
                setLoading(true);
                try {
                    // ê´€ë¦¬ìëŠ” ëª¨ë“  í•™ìƒ, ë‹´ì„êµì‚¬ëŠ” ìì‹ ì˜ ë°˜ë§Œ
                    const classId = user?.role === UserRole.ADMIN ? null : user?.classId;
                    const data = await dataService.getStudents(classId);
                    setStudents(data);
                } catch (error) {
                    console.error('í•™ìƒ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            const canManageStudents = checkPermission(Permission.MANAGE_STUDENTS).allowed;

            if (loading) {
                return <div className="loading">í•™ìƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
            }

            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h2 style={{ margin: 0, color: '#333' }}>í•™ìƒ ê´€ë¦¬</h2>
                        {canManageStudents && (
                            <button className="btn" style={{ width: 'auto', padding: '0.5rem 1rem' }}>
                                + í•™ìƒ ì¶”ê°€
                            </button>
                        )}
                    </div>

                    <div className="card">
                        <div className="card-title">í•™ìƒ ëª©ë¡</div>
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>í•™ë²ˆ</th>
                                    <th>ì´ë¦„</th>
                                    <th>í•™ê¸‰</th>
                                    <th>í•™ë¶€ëª¨ ì—°ë½ì²˜</th>
                                    {canManageStudents && <th>ì‘ì—…</th>}
                                </tr>
                            </thead>
                            <tbody>
                                {students.map(student => (
                                    <tr key={student.id}>
                                        <td>{student.studentNumber}</td>
                                        <td>{student.name}</td>
                                        <td>{student.grade}í•™ë…„</td>
                                        <td>{student.parentContact}</td>
                                        {canManageStudents && (
                                            <td>
                                                <button
                                                    style={{
                                                        background: '#1976d2',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.25rem 0.75rem',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer',
                                                        marginRight: '0.5rem'
                                                    }}
                                                >
                                                    ìˆ˜ì •
                                                </button>
                                                <button
                                                    style={{
                                                        background: '#d32f2f',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.25rem 0.75rem',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    ì‚­ì œ
                                                </button>
                                            </td>
                                        )}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // ì¶œì„ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸
        const Attendance = () => {
            const { user, checkPermission } = useAuth();
            const [attendance, setAttendance] = useState([]);
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(true);

            const dataService = new DataService();

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                setLoading(true);
                try {
                    const [attendanceData, studentsData] = await Promise.all([
                        dataService.getAttendance(null, '2024-01-15'),
                        dataService.getStudents(user?.role === UserRole.ADMIN ? null : user?.classId)
                    ]);

                    // ì¶œì„ ë°ì´í„°ì™€ í•™ìƒ ë°ì´í„° ê²°í•©
                    const combinedData = attendanceData.map(a => {
                        const student = studentsData.find(s => s.id === a.studentId);
                        return { ...a, studentName: student?.name || 'ì•Œ ìˆ˜ ì—†ìŒ' };
                    });

                    setAttendance(combinedData);
                    setStudents(studentsData);
                } catch (error) {
                    console.error('ì¶œì„ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            const getStatusText = (status) => {
                const statusMap = {
                    'present': 'ì¶œì„',
                    'absent': 'ê²°ì„',
                    'late': 'ì§€ê°',
                    'early_leave': 'ì¡°í‡´'
                };
                return statusMap[status] || status;
            };

            const getStatusClass = (status) => {
                const classMap = {
                    'present': 'status-present',
                    'absent': 'status-absent',
                    'late': 'status-late',
                    'early_leave': 'status-late'
                };
                return classMap[status] || '';
            };

            const canManageAttendance = checkPermission(Permission.MANAGE_ATTENDANCE).allowed;

            if (loading) {
                return <div className="loading">ì¶œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
            }

            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h2 style={{ margin: 0, color: '#333' }}>ì¶œì„ ê´€ë¦¬</h2>
                        {canManageAttendance && (
                            <button className="btn" style={{ width: 'auto', padding: '0.5rem 1rem' }}>
                                ì¶œì„ ì²´í¬
                            </button>
                        )}
                    </div>

                    <div className="card">
                        <div className="card-title">ì˜¤ëŠ˜ì˜ ì¶œì„ í˜„í™© (2024-01-15)</div>
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>í•™ìƒëª…</th>
                                    <th>ì¶œì„ ìƒíƒœ</th>
                                    <th>ë‚ ì§œ</th>
                                    {canManageAttendance && <th>ì‘ì—…</th>}
                                </tr>
                            </thead>
                            <tbody>
                                {attendance.map(record => (
                                    <tr key={record.id}>
                                        <td>{record.studentName}</td>
                                        <td>
                                            <span className={`status-badge ${getStatusClass(record.status)}`}>
                                                {getStatusText(record.status)}
                                            </span>
                                        </td>
                                        <td>{record.date}</td>
                                        {canManageAttendance && (
                                            <td>
                                                <button
                                                    style={{
                                                        background: '#1976d2',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.25rem 0.75rem',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer'
                                                    }}
                                                >
                                                    ìˆ˜ì •
                                                </button>
                                            </td>
                                        )}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // ë³´ê³ ì„œ ì»´í¬ë„ŒíŠ¸ (ë‹´ì„êµì‚¬ìš© - í™”ë©´ì—ì„œ ë³´ê¸°)
        const Reports = () => {
            const { user } = useAuth();

            return (
                <div>
                    <h2 style={{ marginBottom: '2rem', color: '#333' }}>ë³´ê³ ì„œ</h2>

                    <div className="card">
                        <div className="card-title">ì´ë²ˆ ì£¼ í•™ê¸‰ í˜„í™© ë³´ê³ ì„œ</div>
                        <div style={{ lineHeight: '1.6' }}>
                            <h4>ğŸ“Š ì¶œì„ í˜„í™©</h4>
                            <p>â€¢ ì „ì²´ ì¶œì„ë¥ : 92.3%</p>
                            <p>â€¢ ì§€ê°: 2ëª…</p>
                            <p>â€¢ ê²°ì„: 1ëª… (ì§ˆë³‘ì‚¬ìœ )</p>

                            <h4>ğŸ‘¥ í•™ê¸‰ ìš´ì˜</h4>
                            <p>â€¢ í•™ê¸‰íšŒì˜ 1íšŒ ì‹¤ì‹œ</p>
                            <p>â€¢ ì²´ìœ¡ëŒ€íšŒ ì¤€ë¹„ ì§„í–‰ ì¤‘</p>
                            <p>â€¢ ì²­ì†Œ êµ¬ì—­ ì¬ë°°ì • ì™„ë£Œ</p>

                            <h4>ğŸ“ í•™ë¶€ëª¨ ìƒë‹´</h4>
                            <p>â€¢ ìƒë‹´ ì™„ë£Œ: 3ê±´</p>
                            <p>â€¢ ì˜ˆì •ëœ ìƒë‹´: 2ê±´</p>
                            <p>â€¢ ì£¼ìš” ìƒë‹´ ë‚´ìš©: í•™ìŠµ íƒœë„ ê°œì„ , êµìš°ê´€ê³„</p>

                            <h4>ğŸ¯ ì´ë²ˆ ì£¼ íŠ¹ì´ì‚¬í•­</h4>
                            <p>â€¢ í™ê¸¸ë™ í•™ìƒ í•™ìŠµ íƒœë„ í¬ê²Œ í–¥ìƒ</p>
                            <p>â€¢ ê¹€ì˜í¬ í•™ìƒ ë¦¬ë”ì‹­ ë°œíœ˜</p>
                            <p>â€¢ ì „ì²´ì ìœ¼ë¡œ ì²´ìœ¡ëŒ€íšŒ ì¤€ë¹„ì— ì ê·¹ì  ì°¸ì—¬</p>

                            <h4>ğŸ“‹ ë‹¤ìŒ ì£¼ ê³„íš</h4>
                            <p>â€¢ ì²´ìœ¡ëŒ€íšŒ ìµœì¢… ì¤€ë¹„</p>
                            <p>â€¢ í•™ë¶€ëª¨ ë©´ë‹´ ì£¼ê°„ ìš´ì˜</p>
                            <p>â€¢ êµì‹¤ í™˜ê²½ ì •ë¹„</p>
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">ì›”ê°„ í•™ê¸‰ ì„±ê³¼</div>
                        <div style={{ lineHeight: '1.6' }}>
                            <h4>ğŸ“ˆ ì´ë‹¬ì˜ ì„±ê³¼</h4>
                            <p>â€¢ í‰ê·  ì¶œì„ë¥  í–¥ìƒ: 89% â†’ 92%</p>
                            <p>â€¢ í•™ê¸‰ ë‚´ ê°ˆë“± ì‚¬ë¡€ ê°ì†Œ</p>
                            <p>â€¢ í•™ë¶€ëª¨ ë§Œì¡±ë„ ì¦ê°€</p>

                            <h4>ğŸ† ìš°ìˆ˜ í•™ìƒ</h4>
                            <p>â€¢ ëª¨ë²”ìƒ: ê¹€ì˜í¬ (ë¦¬ë”ì‹­ ë°œíœ˜)</p>
                            <p>â€¢ í–¥ìƒìƒ: í™ê¸¸ë™ (í•™ìŠµ íƒœë„ ê°œì„ )</p>
                            <p>â€¢ ë´‰ì‚¬ìƒ: ë°•ì² ìˆ˜ (êµì‹¤ ì •ë¦¬ ë„ìš°ë¯¸)</p>

                            <h4>ğŸ’¡ ê°œì„  í•„ìš” ì‚¬í•­</h4>
                            <p>â€¢ ì¼ë¶€ í•™ìƒì˜ ìˆ˜ì—… ì§‘ì¤‘ë„ ê°œì„  í•„ìš”</p>
                            <p>â€¢ êµì‹¤ í™˜ê²½ ì •ë¹„ ì§€ì†ì  ê´€ë¦¬</p>
                            <p>â€¢ í•™ë¶€ëª¨ì™€ì˜ ì†Œí†µ í™•ëŒ€</p>
                        </div>
                    </div>

                    {user?.role === UserRole.ADMIN && (
                        <div className="card">
                            <div className="card-title">ì „ì²´ í•™êµ ë³´ê³ ì„œ</div>
                            <div style={{ lineHeight: '1.6' }}>
                                <h4>ğŸ« ì „ì²´ í˜„í™©</h4>
                                <p>â€¢ ì „ì²´ í•™ìƒ ìˆ˜: 120ëª…</p>
                                <p>â€¢ ì „ì²´ ì¶œì„ë¥ : 94.2%</p>
                                <p>â€¢ ë‹´ì„êµì‚¬ ìˆ˜: 6ëª…</p>

                                <h4>ğŸ“Š ì´ë²ˆ ë‹¬ ì£¼ìš” ì§€í‘œ</h4>
                                <p>â€¢ í•™ê¸‰ë³„ í‰ê·  ì¶œì„ë¥ : 90% ì´ìƒ ë‹¬ì„±</p>
                                <p>â€¢ í•™ë¶€ëª¨ ìƒë‹´ ì‹¤ì‹œìœ¨: 85%</p>
                                <p>â€¢ êµì‚¬-ê´€ë¦¬ì ì†Œí†µ íšŸìˆ˜: ì£¼ 2íšŒ ì´ìƒ</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ì£¼ê°„ê³„íš ì»´í¬ë„ŒíŠ¸ (ê´€ë¦¬ì ì „ìš©)
        const WeeklyPlans = () => {
            const [weeklyPlan, setWeeklyPlan] = useState({
                monday: '', tuesday: '', wednesday: '', thursday: '',
                friday: '', saturday: '', sunday: ''
            });
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [message, setMessage] = useState('');

            const dataService = new DataService();
            const weekId = 'week-2024-01-15'; // í˜„ì¬ ì£¼

            const days = [
                { key: 'monday', label: 'ì›”ìš”ì¼' },
                { key: 'tuesday', label: 'í™”ìš”ì¼' },
                { key: 'wednesday', label: 'ìˆ˜ìš”ì¼' },
                { key: 'thursday', label: 'ëª©ìš”ì¼' },
                { key: 'friday', label: 'ê¸ˆìš”ì¼' },
                { key: 'saturday', label: 'í† ìš”ì¼' },
                { key: 'sunday', label: 'ì¼ìš”ì¼' }
            ];

            useEffect(() => {
                loadWeeklyPlan();
            }, []);

            const loadWeeklyPlan = async () => {
                setLoading(true);
                try {
                    const data = await dataService.getWeeklyPlan(weekId);
                    setWeeklyPlan(data);
                } catch (error) {
                    console.error('ì£¼ê°„ê³„íš ë¡œë”© ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handlePlanChange = (day, value) => {
                setWeeklyPlan(prev => ({
                    ...prev,
                    [day]: value
                }));
            };

            const handleSave = async () => {
                setSaving(true);
                try {
                    await dataService.saveWeeklyPlan(weekId, weeklyPlan);
                    setMessage('ì£¼ê°„ê³„íšì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    setTimeout(() => setMessage(''), 3000);
                } catch (error) {
                    console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                    setMessage('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setSaving(false);
                }
            };

            if (loading) {
                return <div className="loading">ì£¼ê°„ê³„íšì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
            }

            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h2 style={{ margin: 0, color: '#333' }}>ì£¼ê°„ê³„íš ê´€ë¦¬</h2>
                        <button
                            className="btn btn-success"
                            onClick={handleSave}
                            disabled={saving}
                            style={{ width: 'auto', padding: '0.5rem 1rem' }}
                        >
                            {saving ? 'ì €ì¥ ì¤‘...' : 'ê³„íš ì €ì¥'}
                        </button>
                    </div>

                    {message && (
                        <div className={message.includes('ì˜¤ë¥˜') ? 'error-message' : 'success-message'}>
                            {message}
                        </div>
                    )}

                    <div className="card">
                        <div className="card-title">2024ë…„ 1ì›” 3ì£¼ì°¨ (1/15 ~ 1/21)</div>

                        <div className="weekly-plan">
                            {days.map(day => (
                                <div key={day.key} className="day-card">
                                    <div className="day-header">{day.label}</div>
                                    <textarea
                                        className="form-textarea"
                                        value={weeklyPlan[day.key]}
                                        onChange={(e) => handlePlanChange(day.key, e.target.value)}
                                        placeholder={`${day.label} ê³„íšì„ ì…ë ¥í•˜ì„¸ìš”...`}
                                        style={{
                                            width: '100%',
                                            minHeight: '150px',
                                            border: 'none',
                                            background: 'transparent',
                                            resize: 'none',
                                            fontSize: '0.875rem'
                                        }}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-title">ì‘ì„± ê°€ì´ë“œ</div>
                        <div style={{ lineHeight: '1.6', color: '#666' }}>
                            <p><strong>ì‘ì„± ì˜ˆì‹œ:</strong></p>
                            <p>â€¢ 09:00 - ì „ì²´ ì¡°íšŒ</p>
                            <p>â€¢ 10:00 - 1êµì‹œ ìˆ˜í•™</p>
                            <p>â€¢ 11:00 - 2êµì‹œ êµ­ì–´</p>
                            <p>â€¢ 14:00 - ë°©ê³¼í›„ í™œë™</p>
                            <p>â€¢ 15:00 - ì²­ì†Œ ë° ì¢…ë¡€</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ì±„íŒ… ì»´í¬ë„ŒíŠ¸
        const Chat = () => {
            const { user } = useAuth();
            const [selectedTeacher, setSelectedTeacher] = useState(null);
            const [teachers, setTeachers] = useState([]);
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [loading, setLoading] = useState(true);

            const dataService = new DataService();

            useEffect(() => {
                loadTeachers();
            }, []);

            useEffect(() => {
                if (selectedTeacher) {
                    loadMessages();
                }
            }, [selectedTeacher]);

            const loadTeachers = async () => {
                setLoading(true);
                try {
                    const data = await dataService.getHomeroomTeachers();
                    setTeachers(data);
                    if (data.length > 0) {
                        setSelectedTeacher(data[0]);
                    }
                } catch (error) {
                    console.error('êµì‚¬ ëª©ë¡ ë¡œë”© ì˜¤ë¥˜:', error);
                } finally {
                    setLoading(false);
                }
            };

            const loadMessages = async () => {
                if (!selectedTeacher) return;

                try {
                    const userId1 = user?.role === UserRole.ADMIN ? user.id : selectedTeacher.id;
                    const userId2 = user?.role === UserRole.ADMIN ? selectedTeacher.id : 'admin1';
                    const data = await dataService.getChatMessages(userId1, userId2);
                    setMessages(data);
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ë¡œë”© ì˜¤ë¥˜:', error);
                }
            };

            const handleSendMessage = async () => {
                if (!newMessage.trim() || !selectedTeacher) return;

                try {
                    const from = user.id;
                    const to = user?.role === UserRole.ADMIN ? selectedTeacher.id : 'admin1';
                    const message = await dataService.sendChatMessage(from, to, newMessage);
                    setMessages(prev => [...prev, message]);
                    setNewMessage('');
                } catch (error) {
                    console.error('ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            if (loading) {
                return <div className="loading">ì±„íŒ…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
            }

            return (
                <div>
                    <h2 style={{ marginBottom: '2rem', color: '#333' }}>
                        {user?.role === UserRole.ADMIN ? 'ë‹´ì„êµì‚¬ì™€ ì±„íŒ…' : 'ê´€ë¦¬ìì™€ ì±„íŒ…'}
                    </h2>

                    <div style={{ display: 'flex', gap: '2rem' }}>
                        {user?.role === UserRole.ADMIN && (
                            <div style={{ width: '300px' }}>
                                <div className="card">
                                    <div className="card-title">ë‹´ì„êµì‚¬ ëª©ë¡</div>
                                    {teachers.map(teacher => (
                                        <div
                                            key={teacher.id}
                                            style={{
                                                padding: '0.75rem',
                                                margin: '0.5rem 0',
                                                background: selectedTeacher?.id === teacher.id ? '#e3f2fd' : '#f5f5f5',
                                                borderRadius: '8px',
                                                cursor: 'pointer',
                                                border: selectedTeacher?.id === teacher.id ? '2px solid #1976d2' : '2px solid transparent'
                                            }}
                                            onClick={() => setSelectedTeacher(teacher)}
                                        >
                                            <div style={{ fontWeight: '600' }}>{teacher.name}</div>
                                            <div style={{ fontSize: '0.875rem', color: '#666' }}>{teacher.className}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div style={{ flex: 1 }}>
                            <div className="card">
                                <div className="chat-container">
                                    <div className="chat-header">
                                        {user?.role === UserRole.ADMIN
                                            ? `${selectedTeacher?.name} (${selectedTeacher?.className})`
                                            : 'ê¹€ê´€ë¦¬ (ê´€ë¦¬ì)'
                                        }
                                    </div>

                                    <div className="chat-messages">
                                        {messages.map(message => (
                                            <div
                                                key={message.id}
                                                className={`chat-message ${message.from === user.id ? 'own' : 'other'}`}
                                            >
                                                {message.message}
                                            </div>
                                        ))}
                                        {messages.length === 0 && (
                                            <div style={{ textAlign: 'center', color: '#666' }}>
                                                ì•„ì§ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”!
                                            </div>
                                        )}
                                    </div>

                                    <div className="chat-input-area">
                                        <input
                                            className="chat-input"
                                            value={newMessage}
                                            onChange={(e) => setNewMessage(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                        />
                                        <button
                                            className="chat-send-btn"
                                            onClick={handleSendMessage}
                                            disabled={!newMessage.trim()}
                                        >
                                            ì „ì†¡
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸
        const MainApp = () => {
            const [activeScreen, setActiveScreen] = useState('dashboard');

            const renderScreen = () => {
                switch (activeScreen) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'students':
                        return <Students />;
                    case 'attendance':
                        return <Attendance />;
                    case 'reports':
                        return <Reports />;
                    case 'weekly-plans':
                        return <WeeklyPlans />;
                    case 'chat':
                        return <Chat />;
                    default:
                        return <Dashboard />;
                }
            };

            return (
                <div className="app-container">
                    <Header />
                    <div className="main-content">
                        <Sidebar activeScreen={activeScreen} setActiveScreen={setActiveScreen} />
                        <div className="content-area">
                            {renderScreen()}
                        </div>
                    </div>
                </div>
            );
        };

        // ì•± ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸
        const App = () => {
            const { isAuthenticated } = useAuth();

            return isAuthenticated ? <MainApp /> : <LoginScreen />;
        };

        // ì•± ë Œë”ë§
        const AppRoot = () => (
            <AuthProvider>
                <App />
            </AuthProvider>
        );

        ReactDOM.render(<AppRoot />, document.getElementById('root'));
    </script>
</body>
</html>