<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPG to PDF Converter</title>

    <!-- jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ CDNìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸° -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ë§ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        /* ì œëª© ìŠ¤íƒ€ì¼ */
        .title {
            color: #333;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 16px;
            margin-bottom: 30px;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #5a6fd8;
            background: #f0f2ff;
        }

        .upload-area.dragover {
            border-color: #4c63d2;
            background: #e8ebff;
            transform: scale(1.02);
        }

        /* ì—…ë¡œë“œ ì•„ì´ì½˜ */
        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .upload-hint {
            color: #999;
            font-size: 14px;
        }

        /* ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ */
        #fileInput {
            display: none;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 150px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* íŒŒì¼ ì •ë³´ í‘œì‹œ ì˜ì—­ */
        .files-info {
            display: none;
            margin: 20px 0;
        }

        .file-item {
            background: #f0f8ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .file-size {
            color: #666;
            font-size: 12px;
        }

        .remove-file {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .remove-file:hover {
            background: #ff3838;
        }

        .files-summary {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            color: #2c3e50;
            font-weight: 600;
        }

        /* ì„¤ì • íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .settings-panel {
            display: none;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
            text-align: left;
        }

        .settings-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-label {
            display: block;
            color: #555;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .setting-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
        }

        .setting-slider {
            width: 100%;
            margin: 10px 0;
        }

        .slider-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 10px;
        }

        .setting-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
        }

        .setting-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .setting-row .setting-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* PDF í¸ì§‘ íŒ¨ë„ */
        .pdf-editor {
            display: none;
            margin: 20px 0;
        }

        .page-preview {
            display: inline-block;
            margin: 10px;
            position: relative;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-preview:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .page-preview.selected {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .preview-image {
            width: 120px;
            height: 160px;
            object-fit: cover;
            display: block;
        }

        .page-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .page-control-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 3px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-control-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        .page-number {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
        }

        .editor-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .editor-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .editor-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .editor-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ì§„í–‰ë¥  í‘œì‹œ */
        .progress-container {
            display: none;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .error-message {
            display: none;
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #d63031;
        }

        /* ì„±ê³µ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .success-message {
            display: none;
            background: #e8f5e8;
            color: #27ae60;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #27ae60;
        }

        /* ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ */
        .preview-container {
            display: none;
            margin: 20px 0;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì œëª© ì˜ì—­ -->
        <h1 class="title">JPG to PDF ë³€í™˜ê¸°</h1>
        <p class="subtitle">ì—¬ëŸ¬ JPG ì´ë¯¸ì§€ë¥¼ í•˜ë‚˜ì˜ PDF íŒŒì¼ë¡œ ë³€í™˜í•˜ì„¸ìš”</p>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">ğŸ“</div>
            <div class="upload-text">íŒŒì¼ë“¤ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</div>
            <div class="upload-hint">JPG, JPEG íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤ (ì—¬ëŸ¬ íŒŒì¼ ì„ íƒ ê°€ëŠ¥)</div>
        </div>

        <!-- ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
        <input type="file" id="fileInput" accept=".jpg,.jpeg,image/jpeg" multiple>

        <!-- ì„ íƒëœ íŒŒì¼ë“¤ ì •ë³´ í‘œì‹œ -->
        <div class="files-info" id="filesInfo">
            <div class="files-summary" id="filesSummary"></div>
            <div id="filesList"></div>
        </div>

        <!-- ì„¤ì • íŒ¨ë„ -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-title">PDF ìƒì„± ì„¤ì •</div>

            <div class="setting-group">
                <label class="setting-label">ì´ë¯¸ì§€ í’ˆì§ˆ (íŒŒì¼ í¬ê¸°ì— ì˜í–¥)</label>
                <input type="range" class="setting-slider" id="qualitySlider" min="0.1" max="1" step="0.1" value="0.8">
                <span class="slider-value" id="qualityValue">80%</span>
            </div>

            <div class="setting-row">
                <div class="setting-group">
                    <label class="setting-label">ìµœëŒ€ ë„ˆë¹„ (px)</label>
                    <input type="number" class="setting-input" id="maxWidth" value="1200" min="200" max="4000">
                </div>
                <div class="setting-group">
                    <label class="setting-label">ìµœëŒ€ ë†’ì´ (px)</label>
                    <input type="number" class="setting-input" id="maxHeight" value="1600" min="200" max="4000">
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">PDF í˜ì´ì§€ í¬ê¸°</label>
                <select class="setting-select" id="pageSize">
                    <option value="a4">A4 (210 Ã— 297 mm)</option>
                    <option value="a3">A3 (297 Ã— 420 mm)</option>
                    <option value="letter">Letter (216 Ã— 279 mm)</option>
                    <option value="legal">Legal (216 Ã— 356 mm)</option>
                </select>
            </div>

            <div class="setting-group">
                <label class="setting-label">í˜ì´ì§€ ì—¬ë°± (mm)</label>
                <input type="range" class="setting-slider" id="marginSlider" min="0" max="30" step="5" value="10">
                <span class="slider-value" id="marginValue">10mm</span>
            </div>

            <div class="setting-group">
                <label class="setting-label">í•œ PDFì— í¬í•¨í•  ì´ë¯¸ì§€ ê°¯ìˆ˜</label>
                <select class="setting-select" id="imagesPerPDF">
                    <option value="all">ëª¨ë“  ì´ë¯¸ì§€ë¥¼ í•œ PDFì—</option>
                    <option value="1">1ê°œì”© ë³„ë„ PDFë¡œ</option>
                    <option value="2">2ê°œì”© í•˜ë‚˜ì˜ PDFë¡œ</option>
                    <option value="3">3ê°œì”© í•˜ë‚˜ì˜ PDFë¡œ</option>
                    <option value="4">4ê°œì”© í•˜ë‚˜ì˜ PDFë¡œ</option>
                    <option value="5">5ê°œì”© í•˜ë‚˜ì˜ PDFë¡œ</option>
                    <option value="10">10ê°œì”© í•˜ë‚˜ì˜ PDFë¡œ</option>
                    <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
                </select>
            </div>

            <div class="setting-group" id="customImagesGroup" style="display: none;">
                <label class="setting-label">ì‚¬ìš©ì ì§€ì • ê°¯ìˆ˜</label>
                <input type="number" class="setting-input" id="customImagesCount" value="1" min="1" max="100">
            </div>
        </div>

        <!-- PDF í¸ì§‘ íŒ¨ë„ -->
        <div class="pdf-editor" id="pdfEditor">
            <div class="settings-title">PDF í˜ì´ì§€ í¸ì§‘</div>
            <div id="pagePreviewsContainer"></div>
            <div class="editor-controls">
                <button class="editor-btn" id="moveUpBtn" onclick="moveSelectedPages(-1)" disabled>ìœ„ë¡œ ì´ë™</button>
                <button class="editor-btn" id="moveDownBtn" onclick="moveSelectedPages(1)" disabled>ì•„ë˜ë¡œ ì´ë™</button>
                <button class="editor-btn" id="rotateLeftBtn" onclick="rotateSelectedPages(-90)" disabled>ì™¼ìª½ íšŒì „</button>
                <button class="editor-btn" id="rotateRightBtn" onclick="rotateSelectedPages(90)" disabled>ì˜¤ë¥¸ìª½ íšŒì „</button>
                <button class="editor-btn" id="deletePageBtn" onclick="deleteSelectedPages()" disabled>í˜ì´ì§€ ì‚­ì œ</button>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
        <div class="error-message" id="errorMessage"></div>

        <!-- ì„±ê³µ ë©”ì‹œì§€ -->
        <div class="success-message" id="successMessage"></div>

        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="button-group">
            <button class="btn" id="settingsToggleBtn" onclick="toggleSettings()" style="display: none;">ì„¤ì •</button>
            <button class="btn" id="editorToggleBtn" onclick="toggleEditor()" style="display: none;">í¸ì§‘</button>
            <button class="btn" id="convertBtn" onclick="convertToPDF()" disabled>PDFë¡œ ë³€í™˜</button>
            <button class="btn" id="resetBtn" onclick="resetForm()" style="display: none;">ë‹¤ì‹œ ì„ íƒ</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let selectedFiles = []; // ì„ íƒëœ íŒŒì¼ë“¤ì„ ì €ì¥í•  ë°°ì—´
        let fileRotations = {}; // ê° íŒŒì¼ì˜ íšŒì „ ê°ë„ë¥¼ ì €ì¥
        let selectedPages = new Set(); // ì„ íƒëœ í˜ì´ì§€ë“¤
        let pageImages = []; // í˜ì´ì§€ ì´ë¯¸ì§€ ë°ì´í„°

        // DOM ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const filesInfo = document.getElementById('filesInfo');
        const filesSummary = document.getElementById('filesSummary');
        const filesList = document.getElementById('filesList');
        const settingsPanel = document.getElementById('settingsPanel');
        const pdfEditor = document.getElementById('pdfEditor');
        const settingsToggleBtn = document.getElementById('settingsToggleBtn');
        const editorToggleBtn = document.getElementById('editorToggleBtn');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const marginSlider = document.getElementById('marginSlider');
        const marginValue = document.getElementById('marginValue');
        const imagesPerPDF = document.getElementById('imagesPerPDF');
        const customImagesGroup = document.getElementById('customImagesGroup');
        const customImagesCount = document.getElementById('customImagesCount');
        const convertBtn = document.getElementById('convertBtn');
        const resetBtn = document.getElementById('resetBtn');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');

        // íŒŒì¼ ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        fileInput.addEventListener('change', handleFileSelect);

        // ì„¤ì • ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        qualitySlider.addEventListener('input', function() {
            qualityValue.textContent = Math.round(this.value * 100) + '%';
        });

        marginSlider.addEventListener('input', function() {
            marginValue.textContent = this.value + 'mm';
        });

        // ì´ë¯¸ì§€ ê°¯ìˆ˜ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        imagesPerPDF.addEventListener('change', function() {
            if (this.value === 'custom') {
                customImagesGroup.style.display = 'block';
            } else {
                customImagesGroup.style.display = 'none';
            }
            updatePDFPreview();
        });

        customImagesCount.addEventListener('input', function() {
            if (imagesPerPDF.value === 'custom') {
                updatePDFPreview();
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleFileDrop);

        /**
         * ë“œë˜ê·¸ ì˜¤ë²„ ì´ë²¤íŠ¸ ì²˜ë¦¬
         * íŒŒì¼ì´ ë“œë˜ê·¸ë˜ì–´ ì—…ë¡œë“œ ì˜ì—­ ìœ„ì— ìˆì„ ë•Œ ì‹œê°ì  íš¨ê³¼ ì ìš©
         */
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }

        /**
         * ë“œë˜ê·¸ ë¦¬ë¸Œ ì´ë²¤íŠ¸ ì²˜ë¦¬
         * íŒŒì¼ì´ ì—…ë¡œë“œ ì˜ì—­ì„ ë²—ì–´ë‚  ë•Œ ì‹œê°ì  íš¨ê³¼ ì œê±°
         */
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }

        /**
         * íŒŒì¼ ë“œë¡­ ì´ë²¤íŠ¸ ì²˜ë¦¬
         * ë“œë˜ê·¸í•œ íŒŒì¼ë“¤ì´ ì—…ë¡œë“œ ì˜ì—­ì— ë“œë¡­ë˜ì—ˆì„ ë•Œ ì²˜ë¦¬
         */
        function handleFileDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');

            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                processFiles(files);
            }
        }

        /**
         * íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ì²˜ë¦¬
         * íŒŒì¼ ì…ë ¥ì„ í†µí•´ íŒŒì¼ë“¤ì´ ì„ íƒë˜ì—ˆì„ ë•Œ ì²˜ë¦¬
         */
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                processFiles(files);
            }
        }

        /**
         * ì—¬ëŸ¬ íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
         * ì„ íƒëœ íŒŒì¼ë“¤ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³  ëª©ë¡ì„ í‘œì‹œ
         */
        function processFiles(files) {
            // ì´ì „ ë©”ì‹œì§€ë“¤ ìˆ¨ê¸°ê¸°
            hideMessages();

            const validFiles = [];
            const invalidFiles = [];

            // ê° íŒŒì¼ì— ëŒ€í•´ ìœ íš¨ì„± ê²€ì‚¬
            files.forEach(file => {
                // íŒŒì¼ í˜•ì‹ ê²€ì‚¬ (JPG/JPEGë§Œ í—ˆìš©)
                if (!isValidImageFile(file)) {
                    invalidFiles.push(`${file.name} - ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹`);
                    return;
                }

                // íŒŒì¼ í¬ê¸° ê²€ì‚¬ (10MB ì œí•œ)
                if (file.size > 10 * 1024 * 1024) {
                    invalidFiles.push(`${file.name} - íŒŒì¼ í¬ê¸° ì´ˆê³¼ (10MB ì œí•œ)`);
                    return;
                }

                // ì¤‘ë³µ íŒŒì¼ ê²€ì‚¬
                if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    validFiles.push(file);
                }
            });

            // ìœ íš¨í•˜ì§€ ì•Šì€ íŒŒì¼ë“¤ì— ëŒ€í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            if (invalidFiles.length > 0) {
                showError(`ë‹¤ìŒ íŒŒì¼ë“¤ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:\n${invalidFiles.join('\n')}`);
            }

            // ìœ íš¨í•œ íŒŒì¼ë“¤ ì¶”ê°€
            if (validFiles.length > 0) {
                selectedFiles.push(...validFiles);
                displayFilesInfo();
                convertBtn.disabled = false;
                resetBtn.style.display = 'inline-block';
                settingsToggleBtn.style.display = 'inline-block';
                editorToggleBtn.style.display = 'inline-block';

                // í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
                generatePagePreviews();
                updatePDFPreview();

                if (invalidFiles.length === 0) {
                    showSuccess(`${validFiles.length}ê°œì˜ íŒŒì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            } else if (invalidFiles.length === 0) {
                showError('ì„ íƒí•œ íŒŒì¼ë“¤ì´ ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * íŒŒì¼ í˜•ì‹ ìœ íš¨ì„± ê²€ì‚¬
         * JPG/JPEG íŒŒì¼ì¸ì§€ í™•ì¸
         */
        function isValidImageFile(file) {
            const validTypes = ['image/jpeg', 'image/jpg'];
            const validExtensions = ['.jpg', '.jpeg'];

            // MIME íƒ€ì… ê²€ì‚¬
            if (validTypes.includes(file.type)) {
                return true;
            }

            // íŒŒì¼ í™•ì¥ì ê²€ì‚¬ (MIME íƒ€ì…ì´ ì—†ì„ ê²½ìš° ëŒ€ë¹„)
            const fileName = file.name.toLowerCase();
            return validExtensions.some(ext => fileName.endsWith(ext));
        }

        /**
         * íŒŒì¼ë“¤ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
         * ì„ íƒëœ íŒŒì¼ë“¤ì˜ ëª©ë¡ì„ í™”ë©´ì— í‘œì‹œ
         */
        function displayFilesInfo() {
            if (selectedFiles.length === 0) {
                filesInfo.style.display = 'none';
                return;
            }

            // ì „ì²´ íŒŒì¼ ìˆ˜ì™€ í¬ê¸° í‘œì‹œ
            const totalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);
            filesSummary.textContent = `${selectedFiles.length}ê°œ íŒŒì¼ ì„ íƒë¨ (ì´ ${formatFileSize(totalSize)})`;

            // ê° íŒŒì¼ í•­ëª© ìƒì„±
            filesList.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';

                fileItem.innerHTML = `
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})" title="íŒŒì¼ ì œê±°">Ã—</button>
                `;

                filesList.appendChild(fileItem);
            });

            filesInfo.style.display = 'block';
        }

        /**
         * íŒŒì¼ í¬ê¸° í¬ë§·íŒ… í•¨ìˆ˜
         * ë°”ì´íŠ¸ ë‹¨ìœ„ë¥¼ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜
         */
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';

            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));

            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * ê°œë³„ íŒŒì¼ ì œê±° í•¨ìˆ˜
         * ì„ íƒëœ íŒŒì¼ ëª©ë¡ì—ì„œ íŠ¹ì • íŒŒì¼ì„ ì œê±°
         */
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displayFilesInfo();

            if (selectedFiles.length === 0) {
                convertBtn.disabled = true;
                resetBtn.style.display = 'none';
            }

            showSuccess('íŒŒì¼ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');

            // í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            generatePagePreviews();
            updatePDFPreview();
        }

        /**
         * PDF ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
         * ì„ íƒëœ ì„¤ì •ì— ë”°ë¼ ëª‡ ê°œì˜ PDFê°€ ìƒì„±ë ì§€ í‘œì‹œ
         */
        function updatePDFPreview() {
            if (selectedFiles.length === 0) return;

            const imagesPerPDFValue = imagesPerPDF.value;
            let imagesCount;

            if (imagesPerPDFValue === 'all') {
                imagesCount = selectedFiles.length;
            } else if (imagesPerPDFValue === 'custom') {
                imagesCount = parseInt(customImagesCount.value) || 1;
            } else {
                imagesCount = parseInt(imagesPerPDFValue);
            }

            const totalPDFs = Math.ceil(selectedFiles.length / imagesCount);
            const originalSummary = `${selectedFiles.length}ê°œ íŒŒì¼ ì„ íƒë¨ (ì´ ${formatFileSize(selectedFiles.reduce((sum, file) => sum + file.size, 0))})`;

            if (totalPDFs > 1) {
                filesSummary.textContent = `${originalSummary} â†’ ${totalPDFs}ê°œì˜ PDF íŒŒì¼ ìƒì„± ì˜ˆì •`;
            } else {
                filesSummary.textContent = `${originalSummary} â†’ 1ê°œì˜ PDF íŒŒì¼ ìƒì„± ì˜ˆì •`;
            }
        }

        /**
         * PDF ë³€í™˜ ë©”ì¸ í•¨ìˆ˜
         * ì„ íƒëœ ì—¬ëŸ¬ JPG ì´ë¯¸ì§€ë“¤ì„ ì„¤ì •ì— ë”°ë¼ ë‹¤ìˆ˜ì˜ PDFë¡œ ë³€í™˜í•˜ê³  ë‹¤ìš´ë¡œë“œ
         */
        function convertToPDF() {
            if (selectedFiles.length === 0) {
                showError('ë³€í™˜í•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì§„í–‰ë¥  í‘œì‹œ ì‹œì‘
            showProgress();

            // í•œ PDFì— ë“¤ì–´ê°ˆ ì´ë¯¸ì§€ ê°¯ìˆ˜ ê²°ì •
            const imagesPerPDFValue = imagesPerPDF.value;
            let imagesCount;

            if (imagesPerPDFValue === 'all') {
                imagesCount = selectedFiles.length;
            } else if (imagesPerPDFValue === 'custom') {
                imagesCount = parseInt(customImagesCount.value) || 1;
            } else {
                imagesCount = parseInt(imagesPerPDFValue);
            }

            // PDF ê·¸ë£¹ ë‚˜ëˆ„ê¸°
            const pdfGroups = [];
            for (let i = 0; i < selectedFiles.length; i += imagesCount) {
                pdfGroups.push(selectedFiles.slice(i, i + imagesCount));
            }

            const totalPDFs = pdfGroups.length;
            let completedPDFs = 0;
            const pdfResults = [];

            // ê° PDF ê·¸ë£¹ì„ ì²˜ë¦¬
            function processNextPDF() {
                if (completedPDFs >= totalPDFs) {
                    // ëª¨ë“  PDF ìƒì„± ì™„ë£Œ
                    completeAllPDFs(pdfResults);
                    return;
                }

                const currentGroup = pdfGroups[completedPDFs];
                const pdfProgress = Math.floor((completedPDFs / totalPDFs) * 90);
                updateProgress(pdfProgress, `PDF ${completedPDFs + 1}/${totalPDFs} ìƒì„± ì¤‘...`);

                createSinglePDF(currentGroup, completedPDFs + 1, (pdfData, pdfName) => {
                    pdfResults.push({ data: pdfData, name: pdfName });
                    completedPDFs++;
                    processNextPDF();
                });
            }

            // ì²« ë²ˆì§¸ PDF ì²˜ë¦¬ ì‹œì‘
            processNextPDF();
        }

        /**
         * ë‹¨ì¼ PDF ìƒì„± í•¨ìˆ˜
         */
        function createSinglePDF(filesGroup, pdfNumber, callback) {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            let processedCount = 0;
            const totalFiles = filesGroup.length;

            // ì²« ë²ˆì§¸ í˜ì´ì§€ëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ ì œê±° í”Œë˜ê·¸
            let isFirstPage = true;

            // ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜
            function compressImage(canvas, quality) {
                return canvas.toDataURL('image/jpeg', quality);
            }

            // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ í•¨ìˆ˜
            function resizeImage(img, maxWidth, maxHeight, originalIndex) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                let { width, height } = img;

                // ìµœëŒ€ í¬ê¸°ì— ë§ê²Œ ë¹„ìœ¨ ì¡°ì •
                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width = width * ratio;
                    height = height * ratio;
                }

                canvas.width = width;
                canvas.height = height;

                // íšŒì „ ì ìš© - ì›ë³¸ íŒŒì¼ ì¸ë±ìŠ¤ ì‚¬ìš©
                const rotation = fileRotations[originalIndex] || 0;

                if (rotation !== 0) {
                    const centerX = width / 2;
                    const centerY = height / 2;
                    ctx.translate(centerX, centerY);
                    ctx.rotate((rotation * Math.PI) / 180);
                    ctx.translate(-centerX, -centerY);
                }

                ctx.drawImage(img, 0, 0, width, height);
                return canvas;
            }

            // ê° íŒŒì¼ì„ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
            function processNextFile() {
                if (processedCount >= totalFiles) {
                    // ëª¨ë“  íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ
                    completeSinglePDF();
                    return;
                }

                const file = filesGroup[processedCount];
                const originalIndex = selectedFiles.indexOf(file);
                const reader = new FileReader();

                reader.onload = function(e) {
                    const img = new Image();

                    img.onload = function() {
                        try {
                            // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë° ì••ì¶•
                            const maxWidth = parseInt(document.getElementById('maxWidth').value);
                            const maxHeight = parseInt(document.getElementById('maxHeight').value);
                            const quality = parseFloat(qualitySlider.value);

                            const canvas = resizeImage(img, maxWidth, maxHeight, originalIndex);
                            const compressedImage = compressImage(canvas, quality);

                            // ìº”ë²„ìŠ¤ í¬ê¸° ì‚¬ìš©
                            const imgWidth = canvas.width;
                            const imgHeight = canvas.height;

                            // í˜ì´ì§€ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
                            const pageSize = document.getElementById('pageSize').value;
                            let pageWidth, pageHeight;

                            switch(pageSize) {
                                case 'a3':
                                    pageWidth = 297; pageHeight = 420; break;
                                case 'letter':
                                    pageWidth = 216; pageHeight = 279; break;
                                case 'legal':
                                    pageWidth = 216; pageHeight = 356; break;
                                default: // a4
                                    pageWidth = 210; pageHeight = 297;
                            }

                            const margin = parseInt(marginSlider.value);

                            // ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ì—­
                            const availableWidth = pageWidth - (margin * 2);
                            const availableHeight = pageHeight - (margin * 2);

                            // ì´ë¯¸ì§€ë¥¼ í˜ì´ì§€ì— ë§ê²Œ í¬ê¸° ì¡°ì •
                            let finalWidth, finalHeight;
                            const imgRatio = imgWidth / imgHeight;
                            const availableRatio = availableWidth / availableHeight;

                            if (imgRatio > availableRatio) {
                                // ì´ë¯¸ì§€ê°€ ë” ë„“ìŒ - ë„ˆë¹„ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •
                                finalWidth = availableWidth;
                                finalHeight = availableWidth / imgRatio;
                            } else {
                                // ì´ë¯¸ì§€ê°€ ë” ë†’ìŒ - ë†’ì´ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •
                                finalHeight = availableHeight;
                                finalWidth = availableHeight * imgRatio;
                            }

                            // ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ ìœ„ì¹˜ ê³„ì‚°
                            const x = margin + (availableWidth - finalWidth) / 2;
                            const y = margin + (availableHeight - finalHeight) / 2;

                            // ì²« ë²ˆì§¸ í˜ì´ì§€ê°€ ì•„ë‹ˆë©´ ìƒˆ í˜ì´ì§€ ì¶”ê°€
                            if (!isFirstPage) {
                                pdf.addPage();
                            } else {
                                isFirstPage = false;
                            }

                            // ì••ì¶•ëœ ì´ë¯¸ì§€ë¥¼ PDFì— ì¶”ê°€
                            pdf.addImage(compressedImage, 'JPEG', x, y, finalWidth, finalHeight);

                            processedCount++;
                            processNextFile();

                        } catch (error) {
                            console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                            hideProgress();
                            showError(`${file.name} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
                        }
                    };

                    img.onerror = function() {
                        console.error('ì´ë¯¸ì§€ ë¡œë“œ ì˜¤ë¥˜:', file.name);
                        hideProgress();
                        showError(`${file.name} íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                    };

                    img.src = e.target.result;
                };

                reader.onerror = function() {
                    console.error('íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', file.name);
                    hideProgress();
                    showError(`${file.name} íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
                };

                reader.readAsDataURL(file);
            }

            // ë‹¨ì¼ PDF ìƒì„± ì™„ë£Œ ì²˜ë¦¬
            function completeSinglePDF() {
                try {
                    // íŒŒì¼ëª… ìƒì„±
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    let pdfFileName;

                    if (pdfNumber === 1 && filesGroup.length === selectedFiles.length) {
                        // ëª¨ë“  ì´ë¯¸ì§€ê°€ í•œ PDFì— ë“¤ì–´ê°ˆ ë•Œ
                        pdfFileName = `converted-images-${timestamp}.pdf`;
                    } else {
                        // ì—¬ëŸ¬ PDFë¡œ ë‚˜ë‰  ë•Œ
                        pdfFileName = `converted-images-part${pdfNumber}-${timestamp}.pdf`;
                    }

                    // PDF ë°ì´í„° ë°˜í™˜
                    const pdfData = pdf.output('blob');
                    callback(pdfData, pdfFileName);

                } catch (error) {
                    console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                    hideProgress();
                    showError(`PDF ${pdfNumber} ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
                }
            }

            // ì²« ë²ˆì§¸ íŒŒì¼ë¶€í„° ì²˜ë¦¬ ì‹œì‘
            processNextFile();
        }

        /**
         * ëª¨ë“  PDF ìƒì„± ì™„ë£Œ ì²˜ë¦¬
         */
        function completeAllPDFs(pdfResults) {
            updateProgress(95, 'ë‹¤ìš´ë¡œë“œ ì¤€ë¹„ ì¤‘...');

            try {
                // ëª¨ë“  PDF íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                pdfResults.forEach(pdf => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(pdf.data);
                    link.download = pdf.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                });

                updateProgress(100, 'ì™„ë£Œ!');

                setTimeout(() => {
                    hideProgress();
                    if (pdfResults.length === 1) {
                        showSuccess(`${selectedFiles.length}ê°œì˜ ì´ë¯¸ì§€ê°€ ${pdfResults[0].name} íŒŒì¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    } else {
                        showSuccess(`${selectedFiles.length}ê°œì˜ ì´ë¯¸ì§€ê°€ ${pdfResults.length}ê°œì˜ PDF íŒŒì¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    }
                }, 1000);

            } catch (error) {
                console.error('PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                hideProgress();
                showError('PDF íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        /**
         * ì§„í–‰ë¥  í‘œì‹œ í•¨ìˆ˜
         * ë³€í™˜ ì§„í–‰ ìƒí™©ì„ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤Œ
         */
        function showProgress() {
            progressContainer.style.display = 'block';
            convertBtn.disabled = true;
            updateProgress(10, 'ë³€í™˜ ì‹œì‘...');
        }

        /**
         * ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ í•¨ìˆ˜
         * ì§„í–‰ë¥  ë°”ì™€ í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
         */
        function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }

        /**
         * ì§„í–‰ë¥  ìˆ¨ê¹€ í•¨ìˆ˜
         * ë³€í™˜ ì™„ë£Œ í›„ ì§„í–‰ë¥  í‘œì‹œë¥¼ ìˆ¨ê¹€
         */
        function hideProgress() {
            progressContainer.style.display = 'none';
            convertBtn.disabled = false;
        }

        /**
         * ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
         * ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ í‘œì‹œ
         */
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }

        /**
         * ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
         * ë³€í™˜ ì™„ë£Œ ì‹œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
         */
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
        }

        /**
         * ë©”ì‹œì§€ ìˆ¨ê¹€ í•¨ìˆ˜
         * ëª¨ë“  ë©”ì‹œì§€(ì—ëŸ¬, ì„±ê³µ)ë¥¼ ìˆ¨ê¹€
         */
        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
        }

        /**
         * í¼ ì´ˆê¸°í™” í•¨ìˆ˜
         * ëª¨ë“  ì…ë ¥ê³¼ í‘œì‹œë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¼
         */
        function resetForm() {
            // ì„ íƒëœ íŒŒì¼ë“¤ ì´ˆê¸°í™”
            selectedFiles = [];
            fileInput.value = '';

            // UI ìš”ì†Œë“¤ ìˆ¨ê¹€
            filesInfo.style.display = 'none';
            hideMessages();
            hideProgress();

            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            convertBtn.disabled = true;
            resetBtn.style.display = 'none';
            settingsToggleBtn.style.display = 'none';
            editorToggleBtn.style.display = 'none';

            // íŒ¨ë„ ì´ˆê¸°í™”
            settingsPanel.style.display = 'none';
            pdfEditor.style.display = 'none';

            // ë°ì´í„° ì´ˆê¸°í™”
            fileRotations = {};
            selectedPages.clear();
            pageImages = [];

            // ì—…ë¡œë“œ ì˜ì—­ í´ë˜ìŠ¤ ì´ˆê¸°í™”
            uploadArea.classList.remove('dragover');
        }

        /**
         * ì„¤ì • íŒ¨ë„ í† ê¸€ í•¨ìˆ˜
         */
        function toggleSettings() {
            const isVisible = settingsPanel.style.display === 'block';
            settingsPanel.style.display = isVisible ? 'none' : 'block';
            settingsToggleBtn.textContent = isVisible ? 'ì„¤ì •' : 'ì„¤ì • ë‹«ê¸°';
        }

        /**
         * PDF í¸ì§‘ íŒ¨ë„ í† ê¸€ í•¨ìˆ˜
         */
        function toggleEditor() {
            const isVisible = pdfEditor.style.display === 'block';
            pdfEditor.style.display = isVisible ? 'none' : 'block';
            editorToggleBtn.textContent = isVisible ? 'í¸ì§‘' : 'í¸ì§‘ ë‹«ê¸°';
        }

        /**
         * í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ìƒì„± í•¨ìˆ˜
         */
        function generatePagePreviews() {
            if (selectedFiles.length === 0) {
                return;
            }

            const container = document.getElementById('pagePreviewsContainer');
            container.innerHTML = '';
            pageImages = [];

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        pageImages[index] = e.target.result;

                        const preview = document.createElement('div');
                        preview.className = 'page-preview';
                        preview.dataset.index = index;

                        preview.innerHTML = `
                            <img src="${e.target.result}" class="preview-image" alt="Page ${index + 1}">
                            <div class="page-controls">
                                <button class="page-control-btn" onclick="rotatePreview(${index}, -90)" title="ì™¼ìª½ íšŒì „">â†¶</button>
                                <button class="page-control-btn" onclick="rotatePreview(${index}, 90)" title="ì˜¤ë¥¸ìª½ íšŒì „">â†·</button>
                            </div>
                            <div class="page-number">${index + 1}</div>
                        `;

                        preview.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('page-control-btn')) {
                                togglePageSelection(index);
                            }
                        });

                        container.appendChild(preview);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        /**
         * í˜ì´ì§€ ì„ íƒ í† ê¸€ í•¨ìˆ˜
         */
        function togglePageSelection(index) {
            const preview = document.querySelector(`[data-index="${index}"]`);

            if (selectedPages.has(index)) {
                selectedPages.delete(index);
                preview.classList.remove('selected');
            } else {
                selectedPages.add(index);
                preview.classList.add('selected');
            }

            updateEditorButtons();
        }

        /**
         * í¸ì§‘ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
         */
        function updateEditorButtons() {
            const hasSelection = selectedPages.size > 0;

            document.getElementById('moveUpBtn').disabled = !hasSelection;
            document.getElementById('moveDownBtn').disabled = !hasSelection;
            document.getElementById('rotateLeftBtn').disabled = !hasSelection;
            document.getElementById('rotateRightBtn').disabled = !hasSelection;
            document.getElementById('deletePageBtn').disabled = !hasSelection;
        }

        /**
         * í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° íšŒì „
         */
        function rotatePreview(index, angle) {
            if (!fileRotations[index]) {
                fileRotations[index] = 0;
            }

            fileRotations[index] = (fileRotations[index] + angle) % 360;

            const preview = document.querySelector(`[data-index="${index}"] .preview-image`);
            preview.style.transform = `rotate(${fileRotations[index]}deg)`;
        }

        /**
         * ì„ íƒëœ í˜ì´ì§€ë“¤ ì´ë™
         */
        function moveSelectedPages(direction) {
            if (selectedPages.size === 0) return;

            const indices = Array.from(selectedPages).sort((a, b) => direction > 0 ? b - a : a - b);
            const newSelectedFiles = [...selectedFiles];
            const newRotations = {...fileRotations};
            const newSelectedPages = new Set();

            indices.forEach(oldIndex => {
                const newIndex = oldIndex + direction;

                if (newIndex >= 0 && newIndex < selectedFiles.length) {
                    // íŒŒì¼ ìœ„ì¹˜ êµí™˜
                    [newSelectedFiles[oldIndex], newSelectedFiles[newIndex]] =
                    [newSelectedFiles[newIndex], newSelectedFiles[oldIndex]];

                    // íšŒì „ ì •ë³´ êµí™˜
                    [newRotations[oldIndex], newRotations[newIndex]] =
                    [newRotations[newIndex], newRotations[oldIndex]];

                    // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                    newSelectedPages.add(newIndex);
                }
            });

            selectedFiles = newSelectedFiles;
            fileRotations = newRotations;
            selectedPages = newSelectedPages;

            displayFilesInfo();
            generatePagePreviews();

            // ì„ íƒ ìƒíƒœ ë³µì›
            setTimeout(() => {
                selectedPages.forEach(index => {
                    const preview = document.querySelector(`[data-index="${index}"]`);
                    if (preview) preview.classList.add('selected');
                });
                updateEditorButtons();
            }, 100);
        }

        /**
         * ì„ íƒëœ í˜ì´ì§€ë“¤ íšŒì „
         */
        function rotateSelectedPages(angle) {
            selectedPages.forEach(index => {
                rotatePreview(index, angle);
            });
        }

        /**
         * ì„ íƒëœ í˜ì´ì§€ë“¤ ì‚­ì œ
         */
        function deleteSelectedPages() {
            if (selectedPages.size === 0) return;

            const indicesToDelete = Array.from(selectedPages).sort((a, b) => b - a);

            indicesToDelete.forEach(index => {
                selectedFiles.splice(index, 1);
                delete fileRotations[index];
            });

            // íšŒì „ ì •ë³´ ì¬ì •ë ¬
            const newRotations = {};
            Object.keys(fileRotations).forEach(key => {
                const oldIndex = parseInt(key);
                const deletedBefore = indicesToDelete.filter(i => i < oldIndex).length;
                const newIndex = oldIndex - deletedBefore;
                if (newIndex >= 0) {
                    newRotations[newIndex] = fileRotations[oldIndex];
                }
            });
            fileRotations = newRotations;

            selectedPages.clear();

            if (selectedFiles.length === 0) {
                convertBtn.disabled = true;
                resetBtn.style.display = 'none';
                settingsToggleBtn.style.display = 'none';
                editorToggleBtn.style.display = 'none';
                filesInfo.style.display = 'none';
                pdfEditor.style.display = 'none';
            } else {
                displayFilesInfo();
                generatePagePreviews();
                updatePDFPreview();
            }

            updateEditorButtons();
            showSuccess('ì„ íƒëœ í˜ì´ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    </script>
</body>
</html>